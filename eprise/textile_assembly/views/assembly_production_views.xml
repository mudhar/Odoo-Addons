<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="assembly_production_view_form" model="ir.ui.view">
            <field name="name">assembly.production.view.form</field>
            <field name="model">assembly.production</field>
            <field name="arch" type="xml">
                <form string="Assembly Production">
                    <header>
                        <button name="button_process" states="draft" type="object" class="oe_highlight" string="Confirm"/>
                        <button name="button_approve" type="object" string="Approve" states="process" class="oe_highlight"/>
                        <button name="button_cancel" type="object" string="Cancel" states="draft,process,approve" class="oe_highlight"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,process,approve,cancel"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                 <label for="product_tmpl_id" string="Product"/>
                                <div>
                                    <field name="product_tmpl_id"
                                           domain="[('attribute_line_ids', '!=', False)]"
                                           options="{'no_create': True}" class="oe_inline"
                                           attrs="{'readonly':[('state','not in',('draft'))]}"/>
                                    <button name="onchange_product_id"
                                            attrs="{'invisible':[('state','not in',('draft'))]}"
                                            type="object"
                                            string="Update"
                                            class="oe_edit_only oe_link oe_inline"/>
                                </div>
                                <field name="product_categ_id"/>
                                <field name="currency_id"/>
                                <field name="product_uom_id" invisible="1"/>
                            </group>
                            <group>
                                <field name="active" invisible="1"/>
                                <field name="version" invisible="1"/>
                            </group>
                        </group>
                        <group string="Product Component">
                            <field name="variant_line_ids" nolabel="1" >
                                <tree editable="bottom">
                                    <field name="assembly_id" invisible="1"/>
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id" readonly="1"/>
                                    <field name="attribute_value_ids" widget="many2many_tags" readonly="1"/>
                                    <field name="ratio" attrs="{'readonly': [('state', '=', 'draft')], 'required': [('state', '=', 'process')]}" sum="Total Ratio"/>
                                    <field name="state" invisible="1"/>
                                </tree>
                            </field>
                        </group>

                        <group string="Raw Material">
                            <field name="bom_line_ids"  widget="one2many_list" nolabel="1" attrs="{'readonly':[('state','not in',('process'))]}">
                                <tree string="Raw Material" editable="bottom" >
                                    <field name="assembly_id" invisible="1"/>
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id"/>
                                    <field name="product_uom_id"/>
                                    <field name="price_unit"/>
                                    <field name="attribute_value_ids" widget="many2many_tags"  attrs="{'required': [('state', '=', 'process')]}"
                                           domain="[('product_ids.product_tmpl_id', '=', parent.product_tmpl_id)]"/>
                                    <field name="ratio" readonly="True"/>
                                    <field name="price_subtotal"/>
                                    <field name="state" invisible="1"/>
                                </tree>
                            </field>
                        </group>

                        <group string="CMT Materials">
                            <field name="bom_line_ids2"  widget="one2many_list" nolabel="1"  attrs="{'readonly':[('state','not in',('process'))]}">
                                <tree string="CMT Materials" editable="bottom">
                                    <field name="assembly_id" invisible="1"/>
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id"/>
                                    <field name="product_uom_id"/>
                                    <field name="product_qty"/>
                                    <field name="price_unit"/>
                                    <field name="price_subtotal"/>
                                    <field name="state" invisible="1"/>
                                </tree>
                            </field>
                        </group>

                        <group class="oe_subtotal_footer oe_right" colspan="4">
                            <div class="oe_subtotal_footer_separator oe_inline">
                                <label for="amount_total"/>
                            </div>
                            <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator"
                                   widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>

                        <div class="oe_clear"/>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="assembly_production_view_tree" model="ir.ui.view">
            <field name="name">assembly.production.view.tree</field>
            <field name="model">assembly.production</field>
            <field name="arch" type="xml">
                <tree string="Assembly Productin">
                    <field name="name" string="Reference"/>
                    <field name="product_tmpl_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>



        <record id="assembly_production_view_search" model="ir.ui.view">
            <field name="name">assembly.production.view.search</field>
            <field name="model">assembly.production</field>
            <field name="arch" type="xml">
                <search string="Search Assemblys">
                    <field name="name" string="Name"/>
                    <field name="active" string="Active"/>
                    <field name="product_tmpl_id" string="Product"/>
                    <filter name="draft" string="Draft" domain="[('state','=','draft')]"/>
                    <filter name="process" string="On Process" domain="[('state','=','process')]"/>
                    <filter name="approve" string="Approved" domain="[('state','=','approve')]"/>
                </search>
            </field>
        </record>

        <record id="assembly_production_action" model="ir.actions.act_window">
            <field name="name">Assembly Production</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">assembly.production</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    <!-- Add Text Here -->
                </p><p>
                <!-- More details about what a user can do with this object will be OK -->
            </p>
            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="product_template_inherited_view_form" model="ir.ui.view">
            <field name="name">product.template.inherited.view.form</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_only_form_view"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='barcode']" position="after">
                    <!-- Add your fields or attributes here -->
                    <field name="template_code"/>
                </xpath>
            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="product_product_inherited_view_form" model="ir.ui.view">
            <field name="name">product.product.inherited.view.form</field>
            <field name="model">product.product</field>
            <field name="inherit_id" ref="product.product_normal_form_view"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='barcode']" position="after">
                    <!-- Add your fields or attributes here -->
                    <field name="template_code"/>
                </xpath>

            </field>
        </record>

    </data>
</odoo>