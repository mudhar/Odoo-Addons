<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Inherit Form View to Modify it -->
        <record id="mrp_workorder_qc_line_view_form" model="ir.ui.view">
            <field name="name">mrp.workorder.qc.line.form</field>
            <field name="model">mrp.workorder.qc.line</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form string="Input Hasil" create="false">
                    <sheet>
                        <group>
                            <group>
                                <field name="product_id" readonly="1"/>
                                <label for="product_qty"/>
                                <div>
                                    <field name="product_qty" readonly="1"/>
                                    <field name="product_uom_id" readonly="1"/>
                                </div>
                            </group>
                            <group>
                                <field name="work_order_state" invisible="1"/>
                                <field name="is_cutting" invisible="1"/>
                                <field name="next_work_order_id" invisible="1"/>
                            </group>
                            <field name="show_picking"/>

                        </group>

                        <group string="Progress Record">
                            <field name="progress_record_ids" nolabel="1">
                                <tree string="Progress Record" create="false" delete="false" decoration-success="state_log_line=='added'" decoration-danger="state_log_line=='adjustment'">
                                    <field name="name" attrs="{'column_invisible': [('parent.show_picking','!=',False)]}"/>
                                    <field name="product_id"/>
                                    <field name="date_start"/>
                                    <field name="quantity_good"/>
                                    <field name="quantity_reject"/>
                                    <field name="quantity_sample" attrs="{'column_invisible': [('parent.show_picking','!=',False)]}"/>
                                    <field name="user_id"/>
                                    <field name="state_log_line"/>
                                </tree>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Tree Produce Service -->
        <record id="mrp_workorder_service_line_tree" model="ir.ui.view">
            <field name="name">mrp.workorder.service.line.tree</field>
            <field name="model">mrp.workorder.service.line</field>
            <field name="arch" type="xml">
                <tree string="Input Hasil" create="false" delete="false">
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id"/>
                    <field name="price_unit"/>
                </tree>
            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="mrp_production_workcenter_form_view_inherited_production" model="ir.ui.view">
            <field name="name">mrp.production.workcenter.form.view.inherited.production</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.mrp_production_workcenter_form_view_inherit"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='action_see_move_scrap']" position="after">
                    <!-- Add your fields or attributes here -->

                    <button class="oe_stat_button" name="%(template_open_purchase_orders)d" type="action"
                            icon="fa-list-alt" attrs="{'invisible': [('po_count', '=', 0)]}">
                        <field string="#PO" name="po_count" widget="statinfo" />
                    </button>

                </xpath>
                <xpath expr="/form/header/button[last()]" position="after">
                    <!-- Add your fields or attributes here -->
                    <button name="%(action_change_vendor_wizard)d" type="action" string="Change Vendor CMT" class="btn-info"
                            attrs="{'invisible': ['|',('state', 'not in', ('progress')), ('is_change_vendor' ,'!=', False)]}"/>
                    <button name="button_procurement" type="object" string="Create Purchase Order" class="btn-info"
                            attrs="{'invisible': ['|','|',('check_qc_to_done','=',False),('purchase_created','=',True), ('state','=','done')]}"/>
                    <button name="button_skip" type="object" string="Request Skip Process" attrs="{'invisible': ['|','|','|',('is_cutting','=',True),('next_work_order_id','=',False),('state','not in',('pending','ready'))]}" class="btn-warning"/>
                    <button name="button_reject_skip_process" type="object" string="Reject Skip Process" states="waiting skip" class="btn-success" groups="mrp.group_mrp_manager"/>
                    <button name="button_approve_skip_process" type="object" string="Approve Skip Process" states="waiting skip" class="btn-success" groups="mrp.group_mrp_manager"/>
                    <button name="skip_work_order" type="object" string="Skip Process" states="approve skip" class="btn-success" groups="mrp.group_mrp_manager,mrp.group_mrp_user"/>

                    <button name="button_request_new_workorder" type="object" string="Request New Work Order" attrs="{'invisible': ['|','|',('next_work_order_id','=',False),('state','not in',('pending','ready')), ('workorder_created','=',True)]}" class="btn-warning"/>
                    <button name="button_request_reject" type="object" string="Reject Request New Work Order" states="waiting"  class="btn-warning" groups="mrp.group_mrp_manager"/>
                    <button name="button_approve_new_workorder" type="object" string="Approve Request New Work Order" states="waiting"  class="btn-success" groups="mrp.group_mrp_manager"/>
                    <button name="button_new_workorder" type="object" string="Add New Work Order" class="btn-success" groups="mrp.group_mrp_manager,mrp.group_mrp_user" attrs="{'invisible':['|',('state','!=','approve'),('workorder_created','=',True)]}"/>
                </xpath>
                <field name="product_id" position="after">
                    <field name="product_template_id" attrs="{'invisible': [('check_assembly_plan_id','=',False)]}"/>
                    <field name="service_categ_id" invisible="1"/>
                </field>
                <field name="product_id" position="attributes">
                    <attribute name="invisible">[('check_assembly_plan_id', '!=', False)]</attribute>
                </field>

                <xpath expr="//div[hasclass('o_row')]/field[@name='qty_production']" position="after">
                    <!-- Add your fields or attributes here -->
                    <field name="additional_quantity" readonly="1" attrs="{'invisible': ['|',('is_cutting', '!=', False ),('check_assembly_plan_id','=',False)]}"/>
                </xpath>
                <xpath expr="//div[hasclass('o_row')]/field[@name='qty_production']" position="replace">
                    <!--Kalau Posisi pakai attribute, attribut invisible tidak ketrigger -->
                    <field name="qty_production" attrs="{'invisible': ['&amp;',('is_cutting', '=', False),('check_assembly_plan_id','!=',False)]}"/>
                </xpath>
                <xpath expr="//field[@name='qty_producing']" position="replace">
                    <!-- Add your fields or attributes here -->
                    <field name="qty_producing" string="Current Qty" attrs="{'readonly': ['|','|','|',('check_assembly_plan_id','=',True), ('product_tracking', '=', 'serial'), ('state', 'in', ('done', 'cancel'))]}"/>
                    <field name="qc_qty_remaining" readonly="1"/>
                    <field name="tot_qc_qty_produced" invisible="1"/>
                    <field name="qc_done" readonly="1"/>
                </xpath>
                <xpath expr="//field[@name='final_lot_id']" position="attributes">
                    <attribute name="invisible">['|',('product_tracking_template','=','none')]</attribute>
                </xpath>
<!--                <xpath expr="//field[@name='qty_producing']" position="after">-->
<!--                    &lt;!&ndash; Add your fields or attributes here &ndash;&gt;-->
<!--                    <field name="qc_final" invisible="1"/>-->
<!--                </xpath>-->

                <xpath expr="//group" position="inside">
                    <!-- Add your fields or attributes here -->
                    <group>
                        <field name="partner_id" readonly="1" attrs="{'invisible': [('product_template_id', '=', False)]}"/>
                        <field name="check_qc_to_done" invisible="1"/>
                        <field name="is_change_vendor" invisible="1"/>
                        <field name="is_cutting" invisible="1"/>
                        <field name="check_assembly_plan_id" invisible="1"/>
                        <field name="next_work_order_id" invisible="1"/>
                        <field name="workorder_created" invisible="1"/>
                    </group>
                    <group>
                        <field name="date_start"/>
<!--                        <field name="price_paid" readonly="1" invisible="1"/>-->
                        <field name="purchase_created" readonly="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                    </group>

                </xpath>
                <field name="active_move_line_ids" position="after">
                    <field name="check_move_created" groups="base.group_no_one"/>
                    <div>
                        <button name="button_receive_good" type="object" string="Receive Goods" colspan="1"
                                class="btn-info" attrs="{'invisible': ['|','|',('next_work_order_id','!=',False),('state','!=','progress'), ('check_move_created','=',True)]}"/>
                    </div>
                    <field name="qc_ids" nolabel="1" context="{'form_view_ref': 'mrp_workorder_qc_line_view_form', 'default_workorder_id': id}">
                        <tree string="Input Hasil" create="false" delete="false" decoration-info="qty_produced&gt;0.0" decoration-danger="qty_produced&gt;product_qty">
                            <field name="product_id" readonly="1"/>
                            <field name="product_qty" readonly="1"/>
                            <field name="product_uom_id" readonly="1" string="UoM"/>
                            <field name="qc_good" readonly="1"/>
                            <field name="qc_reject" readonly="1"/>
                            <field name="qc_sample" attrs="{'column_invisible': [('parent.next_work_order_id','!=',False)]}"/>
                            <field name="receive_good"/>
                            <field name="state"/>
                            <field name="move_finished_created" string="Picking Created"/>
                            <field name="qty_produced" invisible="1"/>
                            <field name="work_order_state" invisible="1"/>
                            <button name="%(action_change_inputan_qty)d" type="action" string="Input Hasil" class="btn-danger" attrs="{'invisible': ['|',('work_order_state', 'not in', ('progress')), ('state','not in',('process', 'reject'))]}" colspan="1"/>
                            <button name="button_done" type="object" string="Input Done" class="btn-success" attrs="{'invisible': ['|',('state','not in', ('process','reject')), ('work_order_state', 'not in', ('progress'))]}" colspan="1"/>
                            <button name="button_approve" type="object" string="Approve" states="waiting" groups="mrp.group_mrp_manager" class="btn-success" colspan="1"/>
                            <button name="button_reject" type="object" string="Reject" states="waiting" groups="mrp.group_mrp_manager" class="btn-danger" colspan="1"/>
                        </tree>
                    </field>


                    <field name="product_service_ids" nolabel="1"/>

                </field>

            </field>
        </record>

        <record id="mrp_workorder_tree_view_inherit_sequence" model="ir.ui.view">
            <field name="name">mrp.workorder.tree.view.inherit.sequence</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.mrp_production_workcenter_tree_view_inherit"/>
            <field name="arch" type="xml">
                <field name="state" position="before">
                    <field name="sequence"/>
                </field>
                <tree position="attributes">
                    <attribute name="default_order">production_id,sequence</attribute>
                </tree>
            </field>
        </record>

        <record id="workorder_qc_log_line_view_tree" model="ir.ui.view">
            <field name="name">workorder_qc.log.line.view.tree</field>
            <field name="model">workorder_qc.log.line</field>
            <field name="arch" type="xml">
                <tree string="Progress Record" create="false" delete="false" decoration-success="state_log_line=='added'" decoration-danger="state_log_line=='adjustment'">
                    <field name="name" attrs="{'column_invisible': [('parent.show_picking','!=',False)]}"/>
                    <field name="product_id"/>
                    <field name="date_start"/>
                    <field name="quantity_good"/>
                    <field name="quantity_reject"/>
                    <field name="quantity_sample" attrs="{'column_invisible': [('parent.show_picking','!=',False)]}"/>
                    <field name="user_id"/>
                    <field name="state_log_line"/>
                </tree>
            </field>
        </record>
    </data>
</odoo>
