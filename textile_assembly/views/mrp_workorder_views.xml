<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Inherit Form View to Modify it -->
        <record id="mrp_workorder_qc_line_view_form" model="ir.ui.view">
            <field name="name">mrp.workorder.qc.line.form</field>
            <field name="model">mrp.workorder.qc.line</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form string="Input Hasil" create="false" edit="false">
                    <sheet>
                        <group>
                            <group>
                                <field name="product_id" readonly="1"/>
                                <label for="product_qty" string="Quantity Produced"/>
                                <div class="o_row">
                                    <field name="product_qty" readonly="1"/> /
                                    <field name="qc_good" string="Qty Goods" readonly="1"/>
                                    <field name="product_uom_id" readonly="1"/>
                                </div>
                            </group>
                            <group>
                                <field name="backdate_start"/>
                                <field name="backdate_finished"/>
                                <field name="work_order_state" invisible="1"/>
                                <field name="is_cutting" invisible="1"/>
                                <field name="next_work_order_id" invisible="1"/>
                                <field name="is_locked" invisible="1"/>
                            </group>
                            <field name="is_work_order_finishing" invisible="1"/>
                        </group>

                        <notebook>
                            <page string="Progress Records">
                                <group string="Progress Records">
                                    <field name="progress_record_ids" nolabel="1" attrs="{'readonly': [('is_locked','=',True)]}">
                                        <tree string="Progress Records" create="false" delete="false" edit="false">
                                            <field name="qc_id" invisible="1"/>
                                            <field name="date_start"/>
                                            <field name="user_id"/>
                                            <field name="product_id"/>
                                            <field name="quantity_good" sum="Total Qty Good"/>
                                            <field name="quantity_reject" sum="Total Qty Reject"/>
                                            <field name="quantity_sample" attrs="{'column_invisible': [('parent.next_work_order_id','!=',False)]}"/>
                                            <field name="user_id"/>
                                            <field name="state_log_line"/>
                                        </tree>
                                        <form string="Progress Records">
                                            <header>
                                                <field name="state_log_line" widget="statusbar"/>
                                            </header>
                                            <sheet>
                                                <group>
                                                    <group>
                                                        <field name="product_id"/>
                                                        <label for="quantity_good"/>
                                                        <div>
                                                            <field name="quantity_good" class="oe_inline"/>/
                                                            <field name="quantity_reject" class="oe_inline"/>/
                                                            <field name="quantity_sample" class="oe_inline"/>
                                                        </div>
                                                        <field name="date_start"/>
                                                        <field name="user_id"/>
                                                    </group>
                                                </group>
                                            </sheet>
                                        </form>
                                    </field>
                                </group>
                            </page>
                            <page string="Products Finished Move" attrs="{'invisible': [('is_work_order_finishing','=',False)]}">
                                <group string="Products Finished Move">
                                    <field name="qc_finished_ids" nolabel="1" attrs="{'readonly': [('is_locked','=',True)]}">
                                        <tree string="Products Finished Move" create="false" delete="false" edit="false">
                                            <field name="name"/>
                                            <field name="picking_id" invisible="1"/>
                                            <field name="move_id" invisible="1"/>
                                            <field name="qc_log_id" invisible="1"/>
                                            <field name="qc_id" invisible="1"/>
                                            <field name="product_id"/>
                                            <field name="product_uom_id"/>
                                            <field name="product_qty"/>
                                            <field name="move_state"/>
                                        </tree>
                                        <form string="Product Finished Move">
                                            <header>
                                                <field name="move_state" widget="statusbar"/>
                                            </header>
                                            <sheet>
                                                <div class="oe_title">
                                                    <label for="name" class="oe_edit_only"/>
                                                    <h1>
                                                        <field name="name" placeholder="Picking Reference" nolabel="1" readonly="1"/>
                                                    </h1>
                                                </div>
                                                <group>
                                                    <group>
                                                        <field name="product_id"/>
                                                        <label for="product_qty"/>
                                                        <div>
                                                            <field name="product_qty" class="oe_inline"/>
                                                            <span class="oe_inline">.</span>
                                                            <field name="product_uom_id" class="oe_inline"/>
                                                        </div>
                                                    </group>
                                                    <group>
                                                        <field name="backdate_start"/>
                                                        <field name="backdate_finished"/>
                                                    </group>
                                                </group>
                                            </sheet>
                                        </form>
                                    </field>
                                </group>
                            </page>
                            <page string="Products Reject Move" attrs="{'invisible': [('is_work_order_finishing','=',False)]}">
                                <group string="Products Reject Move">
                                    <field name="qc_reject_ids" nolabel="1" attrs="{'readonly': [('is_locked','=',True)]}">
                                        <tree string="Products Reject Move" create="false" delete="false" edit="false">
                                            <field name="name"/>
                                            <field name="picking_id" invisible="1"/>
                                            <field name="move_id" invisible="1"/>
                                            <field name="qc_log_id" invisible="1"/>
                                            <field name="qc_id" invisible="1"/>
                                            <field name="product_id"/>
                                            <field name="product_uom_id"/>
                                            <field name="product_qty"/>
                                            <field name="move_state"/>
                                        </tree>
                                        <form string="Products Reject Move">
                                            <header>
                                                <field name="move_state" widget="statusbar"/>
                                            </header>
                                            <sheet>
                                                <div class="oe_title">
                                                    <label for="name" class="oe_edit_only"/>
                                                    <h1>
                                                        <field name="name" placeholder="Picking Reference" nolabel="1" readonly="1"/>
                                                    </h1>
                                                </div>
                                                <group>
                                                    <group>
                                                        <field name="product_id"/>
                                                        <label for="product_qty"/>
                                                        <div>
                                                            <field name="product_qty" class="oe_inline"  readonly="1"/>
                                                            <span class="oe_inline">.</span>
                                                            <field name="product_uom_id" class="oe_inline"/>
                                                        </div>
                                                    </group>
                                                    <group>
                                                        <field name="backdate_start"/>
                                                        <field name="backdate_finished"/>
                                                    </group>
                                                </group>
                                            </sheet>
                                        </form>
                                    </field>

                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Tree Produce Service -->
        <record id="mrp_workorder_service_line_tree" model="ir.ui.view">
            <field name="name">mrp.workorder.service.line.tree</field>
            <field name="model">mrp.workorder.service.line</field>
            <field name="arch" type="xml">
                <tree string="Product Services" create="false" delete="false" edit="false">
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id"/>
                    <field name="price_unit"/>
                </tree>
            </field>
        </record>
        <record id="mrp_workorder_service_line_form" model="ir.ui.view">
            <field name="name">mrp.workorder.service.line.form</field>
            <field name="model">mrp.workorder.service.line</field>
            <field name="arch" type="xml">
                <form string="Product Service">
                    <sheet>
                        <group>
                            <group>
                                <field name="product_id"/>
                                <label for="product_qty"/>
                                <div>
                                    <field name="product_qty" class="oe_inline"/>
                                    <span class="oe_inline">.</span>
                                    <field name="product_uom_id" class="oe_inline"/>
                                </div>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="mrp_production_workcenter_form_view_inherited_production" model="ir.ui.view">
            <field name="name">mrp.production.workcenter.form.view.inherited.production</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.mrp_production_workcenter_form_view_inherit"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='action_see_move_scrap']" position="after">
                    <!-- Add your fields or attributes here -->

                    <button class="oe_stat_button" name="%(template_open_purchase_orders)d" type="action"
                            icon="fa-list-alt" attrs="{'invisible': [('po_count', '=', 0)]}">
                        <field string="#PO" name="po_count" widget="statinfo" />
                    </button>

                </xpath>

                <xpath expr="//button[@name='record_production']" position="replace">
                    <!-- Add your fields or attributes here -->
                    <button name="record_production" type="object" string="Done" class="btn-success" attrs="{'invisible': ['|', '|', '|', '|',('is_produced', '=', True), ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False), ('produced_less_than_planned','=',True)]}"/>
                    <button name="record_production" type="object" string="Done" class="btn-danger" attrs="{'invisible': ['|', '|', '|', '|',('is_produced', '=', True), ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False), ('produced_less_than_planned','=',False)]}" confirm="Anda Masih Ada Sisa Input Yang Belum Diselesaikan, Apakah Anda Yakin Untuk Melanjutkan"/>
                </xpath>

                <xpath expr="/form/header/button[last()]" position="after">
                    <!-- Add your fields or attributes here -->
                    <button name="%(action_change_vendor_wizard)d" type="action" string="Change Vendor CMT" class="btn-info"
                            attrs="{'invisible': ['|','|','|',('state', 'not in', ('progress')), ('is_change_vendor' ,'!=', False), ('is_cutting','=',False),('next_work_order_id','=',False)]}"/>
                    <button name="button_procurement" type="object" string="Create Purchase Order" class="btn-info"
                            attrs="{'invisible': ['|','|',('check_qc_to_done','=',False),('purchase_created','=',True), ('state','=','done')]}"/>
                    <button name="button_skip" type="object" string="Request Skip Process" attrs="{'invisible': ['|','|','|','|',('prev_wo_done','=',False),('is_cutting','=',True),('next_work_order_id','=',False),('state','not in',('pending','ready'))]}" class="btn-warning"/>
                    <button name="button_reject_skip_process" type="object" string="Reject Skip Process" states="waiting skip" class="btn-success" groups="mrp.group_mrp_manager"/>
                    <button name="button_approve_skip_process" type="object" string="Approve Skip Process" states="waiting skip" class="btn-success" groups="mrp.group_mrp_manager"/>
                    <button name="skip_work_order" type="object" string="Skip Process" states="approve skip" class="btn-success" groups="mrp.group_mrp_manager,mrp.group_mrp_user"/>

                    <button name="button_request_new_workorder" type="object" string="Request New Work Order" attrs="{'invisible': ['|','|',('next_work_order_id','=',False),('state','not in',('pending','ready')), ('workorder_created','=',True)]}" class="btn-warning"/>
                    <button name="button_request_reject" type="object" string="Reject Request New Work Order" states="waiting"  class="btn-warning" groups="mrp.group_mrp_manager"/>
                    <button name="button_approve_new_workorder" type="object" string="Approve Request New Work Order" states="waiting"  class="btn-success" groups="mrp.group_mrp_manager"/>
                    <button name="button_new_workorder" type="object" string="Add New Work Order" class="btn-success" groups="mrp.group_mrp_manager,mrp.group_mrp_user" attrs="{'invisible':['|',('state','!=','approve'),('workorder_created','=',True)]}"/>
                    <button name="button_add_product_service" type="object" string="Add New Product Service" class="btn-info" attrs="{'invisible': ['|',('is_work_order_finish','=',True),('state','not in',('pending','ready'))]}"/>
                    <button name="button_remove_product_service" type="object" string="Remove Product Service" class="btn-danger" attrs="{'invisible': ['|',('is_work_order_finish','=',True), ('state','not in',('pending','ready'))]}"/>
                </xpath>
                <field name="product_id" position="after">
                    <field name="product_template_id" attrs="{'invisible': [('check_assembly_plan_id','=',False)]}"/>
                    <field name="service_categ_id" invisible="1"/>
                    <field name="location_reject_id" invisible="1"/>
                    <field name="prev_wo_done" invisible="1"/>
                    <field name="produced_less_than_planned" invisible="1"/>
                    <field name="is_work_order_finish" invisible="1"/>
                </field>
                <field name="product_id" position="attributes">
                    <attribute name="invisible">[('check_assembly_plan_id', '!=', False)]</attribute>
                </field>

                <xpath expr="//div[hasclass('o_row')]/field[@name='qty_production']" position="after">
                    <!-- Add your fields or attributes here -->
                    <field name="additional_quantity" readonly="1" attrs="{'invisible': ['|',('is_cutting', '!=', False ),('check_assembly_plan_id','=',False)]}"/>
                </xpath>
                <xpath expr="//div[hasclass('o_row')]/field[@name='qty_production']" position="replace">
                    <!--Kalau Posisi pakai attribute, attribut invisible tidak ketrigger -->
                    <field name="qty_production" attrs="{'invisible': ['&amp;',('is_cutting', '=', False),('check_assembly_plan_id','!=',False)]}"/>
                </xpath>
                <xpath expr="//field[@name='qty_producing']" position="replace">
                    <!-- Add your fields or attributes here -->
                    <field name="qty_producing" string="Current Qty" attrs="{'readonly': ['|','|','|',('check_assembly_plan_id','=',True), ('product_tracking', '=', 'serial'), ('state', 'in', ('done', 'cancel'))]}"/>
                    <field name="qc_qty_remaining" readonly="1"/>
                    <field name="tot_qc_qty_produced" invisible="1"/>
                    <field name="qc_done" readonly="1"/>
                </xpath>
                <xpath expr="//field[@name='final_lot_id']" position="attributes">
                    <attribute name="invisible">['|',('product_tracking_template','=','none')]</attribute>
                </xpath>

                <xpath expr="//group" position="inside">
                    <!-- Add your fields or attributes here -->
                    <group>
                        <field name="partner_id" readonly="1" attrs="{'invisible': [('product_template_id', '=', False)]}"/>
                        <field name="check_qc_to_done" invisible="1"/>
                        <field name="is_change_vendor" invisible="1"/>
                        <field name="is_cutting" invisible="1"/>
                        <field name="check_assembly_plan_id" invisible="1"/>
                        <field name="next_work_order_id" invisible="1"/>
                        <field name="workorder_created" invisible="1"/>
                    </group>
                    <group>
                        <field name="backdate_start"/>
                        <field name="backdate_finished"/>
                        <field name="purchase_created" readonly="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="is_locked" invisible="1"/>
                    </group>

                </xpath>
                <field name="active_move_line_ids" position="after">
                    <field name="check_move_created" groups="base.group_no_one"/>
                    <div>
                        <button name="button_receive_good" type="object" string="Receive Goods" colspan="1"
                                class="btn-info" attrs="{'invisible': ['|','|',('next_work_order_id','!=',False),('state','!=','progress'), ('check_move_created','=',True)]}"/>
                    </div>
                    <field name="qc_ids" nolabel="1" context="{'form_view_ref': 'mrp_workorder_qc_line_view_form', 'default_workorder_id': id}">
                        <tree string="Input Hasil" create="false" delete="false" decoration-info="qty_produced&gt;0.0" decoration-danger="qty_produced&gt;product_qty">
                            <field name="is_work_order_finishing" invisible="1"/>
                            <field name="product_id" readonly="1"/>
                            <field name="product_qty" readonly="1"/>
                            <field name="product_uom_id" readonly="1" string="UoM"/>
                            <field name="qc_good" readonly="1"/>
                            <field name="qc_reject" readonly="1"/>
                            <field name="qc_sample" attrs="{'column_invisible': [('parent.next_work_order_id','!=',False)]}"/>
                            <field name="receive_good" attrs="{'column_invisible': [('parent.next_work_order_id','!=',False)]}"/>
                            <field name="picking_count" attrs="{'column_invisible': [('parent.next_work_order_id','!=',False)]}"/>
                            <field name="state"/>
                            <field name="qty_produced" invisible="1"/>
                            <field name="work_order_state" invisible="1"/>
                            <button name="%(action_change_inputan_qty)d" type="action" string="Input Hasil" class="btn-danger" attrs="{'invisible': ['|',('work_order_state', 'not in', ('progress')), ('state','not in',('process', 'reject'))]}" colspan="1"/>
                            <button name="button_done" type="object" string="Input Done" class="btn-success" attrs="{'invisible': ['|',('state','not in', ('process','reject')), ('work_order_state', 'not in', ('progress'))]}" colspan="1"/>
                            <button name="button_approve" type="object" string="Approve" states="waiting" groups="mrp.group_mrp_manager" class="btn-success" colspan="1"/>
                            <button name="button_reject" type="object" string="Reject" states="waiting" groups="mrp.group_mrp_manager" class="btn-danger" colspan="1"/>
                        </tree>
                    </field>


                    <field name="product_service_ids" nolabel="1"
                           context="{'tree_view_ref': 'textile_assembly.mrp_workorder_service_line_tree', 'form_view': 'textile_assembly.mrp_workorder_service_line_form'}"
                           attrs="{'readonly': [('is_locked','=',True)]}"
                    />
                </field>

            </field>
        </record>

        <record id="mrp_workorder_tree_view_inherit_sequence" model="ir.ui.view">
            <field name="name">mrp.workorder.tree.view.inherit.sequence</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.mrp_production_workcenter_tree_view_inherit"/>
            <field name="arch" type="xml">
                <field name="state" position="before">
                    <field name="sequence"/>
                </field>
                <tree position="attributes">
                    <attribute name="default_order">production_id,sequence</attribute>
                </tree>
            </field>
        </record>

        <!-- Work Order Tree Replace product_id -->
        <record id="mrp_production_workcenter_tree_view_inherit_assembly" model="ir.ui.view">
            <field name="name">mrp.production.workcenter.tree.view.inherit.assembly</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.mrp_production_workcenter_tree_view_inherit"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='product_id']" position="replace">
                    <!-- Add new fields here -->
                    <field name="product_template_id"/>
                </xpath>

            </field>
        </record>


    </data>
</odoo>
